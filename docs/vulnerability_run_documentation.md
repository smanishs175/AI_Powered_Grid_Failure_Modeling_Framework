# Vulnerability Analysis Module Documentation

## Overview

The Vulnerability Analysis Module is a component of the Grid Failure Modeling Framework designed to assess and quantify the vulnerability of power grid components under various environmental conditions. The module uses historical data on grid components, weather patterns, and outage records to identify vulnerable components and determine critical environmental thresholds that may lead to grid failures.

## How to Run the Module

### Prerequisites

Before running the module, ensure you have:

1. Python 3.9 or higher installed
2. Required packages installed:
   ```
   pip install pandas numpy matplotlib scipy statsmodels seaborn
   ```
3. Input data prepared in the expected format (or use synthetic data generation)

### Running the Module

#### Option 1: Using the Example Script

The simplest way to run the module is to use the provided example script:

```bash
python examples/vulnerability_analysis_example.py
```

This script demonstrates the full functionality of the module using synthetic data. By default, it will:
1. Generate synthetic data if it doesn't exist
2. Initialize the Vulnerability Analysis Module
3. Run the complete analysis pipeline
4. Save the results and visualizations
5. Display a summary of the findings

#### Option 2: Using the Module in Your Own Script

To use the module in your own script:

```python
from gfmf.vulnerability_analysis import VulnerabilityAnalyzer

# Initialize the analyzer
vulnerability_analyzer = VulnerabilityAnalyzer(
    config_path="path/to/config.yaml"  # Optional, uses default if not provided
)

# Load data (either from existing files or your data sources)
vulnerability_analyzer.load_data(
    grid_components_path="path/to/grid_components.csv",
    weather_history_path="path/to/weather_history.csv",
    outage_records_path="path/to/outage_records.csv",
    combined_dataset_path="path/to/combined_dataset.csv"
)

# Run the analysis
results = vulnerability_analyzer.run_analysis()

# Access the results
component_scores = results['component_vulnerability_scores']
environmental_threats = results['environmental_threats']
correlation_matrices = results['correlation_matrices']

# Save the results (optional)
vulnerability_analyzer.save_results(
    save_path="path/to/save/results/"
)
```

### Configuration

The module can be configured using a YAML configuration file. The default configuration is located at:
```
gfmf/vulnerability_analysis/config/default_config.yaml
```

You can override this by providing your own configuration file when initializing the module.

## What Happens During Execution

When you run the Vulnerability Analysis Module, the following processes occur:

### 1. Data Loading and Validation

The module loads and validates the following data:
- **Grid Components**: Information about grid components (lines, nodes, transformers)
- **Weather History**: Historical weather data (temperature, wind, precipitation) 
- **Outage Records**: Records of past outages with timestamps, locations, and causes
- **Combined Dataset**: A time series that integrates grid, weather, and outage data

If using synthetic data, the module can generate representative datasets that mimic real-world patterns.

### 2. Component Vulnerability Profiling

This step analyzes the vulnerability of individual grid components:
- Calculates failure rates under different environmental conditions
- Computes confidence intervals for vulnerability estimates
- Assigns vulnerability scores and risk categories
- Ranks components by vulnerability

The component profiler identifies which components are most likely to fail during adverse conditions, allowing for targeted hardening strategies.

### 3. Environmental Threat Modeling

The environmental threat modeler:
- Identifies critical thresholds for each weather parameter
- Quantifies the relationship between environmental conditions and outage probability
- Calculates cumulative threat over time periods
- Maps environmental threats to geographic regions

This analysis helps understand which environmental factors pose the greatest risk to grid reliability.

### 4. Correlation Analysis

The correlation analyzer examines relationships between:
- Weather parameters and outage frequency
- Component characteristics and failure rates
- Temporal patterns and seasonal factors

Multiple correlation methods (Pearson, Spearman, partial correlation) are used to identify both direct and indirect relationships between variables.

### 5. Results Compilation and Visualization

Finally, the module:
- Compiles all analysis results into comprehensive datasets
- Generates visualizations (heatmaps, bar charts, time series plots)
- Creates a summary report of key findings
- Saves all outputs to specified directories

## Output Structure

The module produces the following outputs:

```
data/vulnerability_analysis/
├── component_profiling/
│   ├── vulnerability_scores.pkl
│   ├── vulnerability_scores.csv
│   └── visualizations/
├── environmental_modeling/
│   ├── environmental_thresholds.pkl
│   ├── environmental_thresholds.json
│   └── visualizations/
├── correlation_analysis/
│   ├── correlation_matrices.pkl
│   ├── top_correlations.csv
│   └── visualizations/
├── compiled_results.pkl
└── analysis_summary.json
```

Example visualizations are also saved to:
```
examples/results/
```

## Interpreting the Results

The results of the vulnerability analysis provide insights into:

1. **Which components to prioritize for maintenance or replacement**: Components with high vulnerability scores should be first in line for hardening or replacement.

2. **What environmental conditions to monitor**: Critical thresholds identified in the analysis indicate when to increase grid monitoring or implement preventive measures.

3. **How to improve grid resilience**: Correlation analysis reveals which factors have the strongest relationship with outages, guiding system-wide improvements.

4. **Where to focus resources**: Geographic and temporal patterns show where and when grid vulnerabilities are highest.

## Troubleshooting

Common issues that may occur when running the module:

- **Data format errors**: Ensure input data has the expected format and column names
- **Missing dependencies**: Verify all required packages are installed
- **Memory limitations**: For large datasets, consider using a machine with more RAM
- **Visualization errors**: If using a headless server, set `matplotlib.use('Agg')` before imports

For any issues, check the log files which contain detailed information about the execution process.
