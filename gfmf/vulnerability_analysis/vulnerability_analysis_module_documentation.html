<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vulnerability Analysis Module Documentation - Grid Failure Modeling Framework</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        h1, h2, h3, h4 {
            color: #2c3e50;
        }
        h1 {
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        h2 {
            border-bottom: 1px solid #bdc3c7;
            padding-bottom: 5px;
            margin-top: 30px;
        }
        pre {
            background-color: #f8f8f8;
            border: 1px solid #ddd;
            border-radius: 3px;
            padding: 15px;
            overflow-x: auto;
        }
        code {
            font-family: Consolas, Monaco, 'Andale Mono', monospace;
            background-color: #f4f4f4;
            padding: 2px 4px;
            border-radius: 3px;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
        }
        th, td {
            text-align: left;
            padding: 8px;
            border: 1px solid #ddd;
        }
        th {
            background-color: #f2f2f2;
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        .workflow-container {
            margin: 30px 0;
            text-align: center;
        }
        .workflow {
            max-width: 100%;
        }
        .note {
            background-color: #e7f4ff;
            border-left: 4px solid #3498db;
            padding: 15px;
            margin: 20px 0;
        }
        .warning {
            background-color: #fff5e6;
            border-left: 4px solid #e67e22;
            padding: 15px;
            margin: 20px 0;
        }
        .function-signature {
            font-weight: bold;
            margin-bottom: 10px;
        }
        .parameter {
            margin-left: 20px;
            margin-bottom: 5px;
        }
        .returns {
            margin-top: 10px;
            font-style: italic;
        }
        .directory-structure {
            font-family: monospace;
            white-space: pre;
            background-color: #f8f8f8;
            border: 1px solid #ddd;
            border-radius: 3px;
            padding: 15px;
            overflow-x: auto;
        }
        .command {
            background-color: #2c3e50;
            color: white;
            padding: 10px;
            border-radius: 3px;
            margin: 10px 0;
        }
        .diagram-container {
            width: 100%;
            overflow-x: auto;
            margin: 20px 0;
        }
        .mermaid {
            margin: 0 auto;
        }
        .error {
            background-color: #ffebee;
            color: #c62828;
            padding: 15px;
            border-left: 4px solid #c62828;
            margin: 20px 0;
            font-weight: bold;
        }
        .custom-diagram-container {
            position: relative;
            width: 100%;
            margin: 20px 0;
            overflow-x: auto;
        }
        .module-title {
            position: absolute;
            top: 10px;
            right: 30px;
            background-color: #fff9c4;
            padding: 5px 10px;
            border-radius: 4px;
            font-weight: bold;
            color: #333;
            z-index: 10;
            border: 1px solid #f57f17;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@11.6.0/dist/mermaid.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            mermaid.initialize({
                startOnLoad: true,
                theme: 'default',
                securityLevel: 'loose',
                fontFamily: 'Arial, sans-serif',
                fontSize: 16
            });
            
            // Error handling
            mermaid.parseError = function(err, hash) {
                console.error("Mermaid error:", err);
                // Replace diagram with error message for users
                const diagrams = document.getElementsByClassName('mermaid');
                for (let i = 0; i < diagrams.length; i++) {
                    if (diagrams[i].innerHTML.includes(hash.str)) {
                        diagrams[i].innerHTML = `<div class="error">Diagram rendering error: ${err}</div>`;
                    }
                }
            };
        });
    </script>
</head>
<body>
    <h1>Vulnerability Analysis Module Documentation</h1>
    <p>
        The Vulnerability Analysis Module is the second module of the Grid Failure Modeling Framework (GFMF).
        It analyzes and quantifies power grid component vulnerabilities under various environmental conditions.
        This module helps identify high-risk components and environmental factors that contribute to failures.
    </p>

    <h2>Table of Contents</h2>
    <ol>
        <li><a href="#directory-structure">Directory Structure</a></li>
        <li><a href="#workflow">Workflow Diagram</a></li>
        <li><a href="#components">Module Components</a></li>
        <li><a href="#files">File Descriptions</a></li>
        <li><a href="#classes">Key Classes and Functions</a></li>
        <li><a href="#execution">Execution Commands</a></li>
        <li><a href="#configuration">Configuration</a></li>
        <li><a href="#detailed-components">Detailed Component Documentation</a></li>
    </ol>

    <h2 id="directory-structure">1. Directory Structure</h2>
    <div class="directory-structure">
gfmf/
└── vulnerability_analysis/
    ├── __init__.py                   # Module initialization and main class
    ├── component_profiler.py         # Component vulnerability profiling
    ├── environmental_modeler.py      # Environmental threat modeling
    ├── correlation_analyzer.py       # Correlation analysis between components and environment
    ├── config/
    │   └── default_config.yaml       # Default configuration
    └── utils/
        ├── __init__.py               # Utils initialization
        ├── statistical_tools.py      # Statistical analysis utilities
        ├── visualization.py          # Visualization utilities
        └── validators.py             # Data validation utilities
    </div>

    <h2 id="workflow">2. Workflow Diagram</h2>

    <div class="custom-diagram-container">
        <div class="module-title">Vulnerability Analysis Module</div>
        <div class="mermaid">
%%{init: {'theme': 'default', 'themeVariables': { 'fontSize': '16px'}}}%%
flowchart TD
    subgraph Input["Input"]
        A["Grid Component Data"] --> D
        B["Weather History Data"] --> D
        C["Outage Records"] --> D
    end
    
    subgraph VAM[" "]
        D["Data Loading & Validation"] --> E
        E["Component Profiling"] --> H
        E --> F
        D --> F
        F["Environmental Threat Modeling"] --> H
        D --> G
        F --> G
        E --> G
        G["Correlation Analysis"] --> H
        H["Integrated Vulnerability Assessment"]
    end
    
    subgraph Output["Output"]
        H --> I["Component Vulnerability Scores"]
        H --> J["Environmental Threat Profiles"]
        H --> K["Correlation Analysis Results"]
        H --> L["Integrated Vulnerability Report"]
    end
    
    classDef inputStyle fill:#e1f5fe,stroke:#01579b;
    classDef moduleStyle fill:#fff9c4,stroke:#f57f17;
    classDef outputStyle fill:#e8f5e9,stroke:#2e7d32;
    
    class Input inputStyle;
    class VAM moduleStyle;
    class Output outputStyle;
        </div>
    </div>

    <p>The workflow of the Vulnerability Analysis Module consists of these key steps:</p>
    <ol>
        <li><strong>Data Loading & Validation</strong>: Load processed data from Module 1 (Grid Component Data, Weather History, Outage Records) and validate for completeness and consistency</li>
        <li><strong>Component Profiling</strong>: Analyze individual grid components based on historical outage data and component characteristics</li>
        <li><strong>Environmental Threat Modeling</strong>: Identify and quantify environmental conditions that increase failure risk</li>
        <li><strong>Correlation Analysis</strong>: Analyze relationships between component characteristics, environmental conditions, and outage events</li>
        <li><strong>Integrated Vulnerability Assessment</strong>: Combine all analyses to produce a comprehensive vulnerability assessment</li>
    </ol>
    
    <div class="diagram-container">
        <div class="mermaid">
%%{init: {'theme': 'default', 'themeVariables': { 'fontSize': '16px'}}}%%
flowchart LR
    subgraph CP["Component Profiling"]
        CP1["Feature Extraction"] --> CP2["Model Training"]
        CP2 --> CP3["Vulnerability Scoring"]
        CP3 --> CP4["Visualization"]
    end
    
    subgraph ETM["Environmental Threat Modeling"]
        ET1["Threat Threshold Identification"] --> ET2["Threat Level Calculation"]
        ET2 --> ET3["Time-Lagged Analysis"]
        ET3 --> ET4["Threat Profile Generation"]
    end
    
    subgraph CA["Correlation Analysis"]
        CA1["Combined Dataset Creation"] --> CA2["Calculate Correlation Matrices"]
        CA2 --> CA3["Calculate Partial Correlations"]
        CA3 --> CA4["Group Component Analysis"]
    end
    
    classDef cpStyle fill:#ffecb3,stroke:#ff6f00;
    classDef etmStyle fill:#e1bee7,stroke:#8e24aa;
    classDef caStyle fill:#c8e6c9,stroke:#388e3c;
    
    class CP cpStyle;
    class ETM etmStyle;
    class CA caStyle;
        </div>
    </div>

    <h2 id="components">3. Module Components</h2>
    <p>The Vulnerability Analysis Module consists of the following major components:</p>
    
    <h3>3.1. Component Profiler</h3>
    <p>
        The Component Profiler analyzes individual grid components based on historical outage data and component characteristics.
        It generates vulnerability scores for each component using machine learning models and statistical analysis.
    </p>
    
    <h3>3.2. Environmental Threat Modeler</h3>
    <p>
        The Environmental Threat Modeler identifies and quantifies environmental conditions that increase failure risk.
        It analyzes weather data to determine threat thresholds and creates environmental threat profiles.
    </p>
    
    <h3>3.3. Correlation Analyzer</h3>
    <p>
        The Correlation Analyzer examines relationships between component characteristics, environmental conditions, and outage events.
        It generates correlation matrices and identifies significant relationships between variables.
    </p>

    <h2 id="files">4. File Descriptions</h2>
    
    <h3>4.1. __init__.py</h3>
    <p>
        This is the main file containing the <code>VulnerabilityAnalysisModule</code> class, which provides a unified interface 
        for all vulnerability analysis operations. It integrates the component profiler, environmental threat modeler, and 
        correlation analyzer into a cohesive workflow.
    </p>
    
    <h3>4.2. component_profiler.py</h3>
    <p>
        This file contains the <code>ComponentProfiler</code> class for analyzing individual grid components based on historical 
        outage data and component characteristics. It uses machine learning models to generate vulnerability scores for each component.
    </p>
    
    <h3>4.3. environmental_modeler.py</h3>
    <p>
        This file contains the <code>EnvironmentalThreatModeler</code> class for identifying and quantifying environmental 
        conditions that increase failure risk. It analyzes weather data to determine threat thresholds and creates environmental 
        threat profiles.
    </p>
    
    <h3>4.4. correlation_analyzer.py</h3>
    <p>
        This file contains the <code>CorrelationAnalyzer</code> class for examining relationships between component characteristics, 
        environmental conditions, and outage events. It generates correlation matrices and identifies significant relationships 
        between variables.
    </p>
    
    <h3>4.5. config/default_config.yaml</h3>
    <p>
        This file contains the default configuration settings for the Vulnerability Analysis Module, including parameters for 
        component profiling, environmental threat modeling, correlation analysis, visualization, and logging.
    </p>
    
    <h3>4.6. utils/statistical_tools.py</h3>
    <p>
        This file contains utility functions for statistical analysis, including correlation calculation, outlier detection, 
        bootstrapping, and failure probability estimation.
    </p>
    
    <h3>4.7. utils/visualization.py</h3>
    <p>
        This file contains utility functions for creating visualizations related to vulnerability analysis, including component 
        vulnerability plots, correlation matrices, and environmental threat heatmaps.
    </p>
    
    <h3>4.8. utils/validators.py</h3>
    <p>
        This file contains utility functions for validating input data, ensuring data completeness, consistency, and compatibility.
    </p>

    <h2 id="classes">5. Key Classes and Functions</h2>
    
    <h3>5.1. VulnerabilityAnalysisModule</h3>
    <p class="function-signature">class VulnerabilityAnalysisModule(config_path: Optional[str] = None)</p>
    <p>Main class for the Vulnerability Analysis Module that integrates all components.</p>
    <p>Key methods:</p>
    
    <div class="function-signature">load_input_data(use_synthetic: bool = False) -> Dict[str, Any]</div>
    <p>Loads processed data from Module 1 (Data Management Module).</p>
    <p class="parameter"><strong>use_synthetic</strong>: Whether to load synthetic data</p>
    <p class="returns">Returns: Dictionary containing loaded data</p>
    
    <div class="function-signature">run_analysis(use_synthetic: bool = False) -> Dict[str, Any]</div>
    <p>Runs the complete vulnerability analysis workflow.</p>
    <p class="parameter"><strong>use_synthetic</strong>: Whether to use synthetic data</p>
    <p class="returns">Returns: Dictionary containing analysis results</p>
    
    <h3>5.2. ComponentProfiler</h3>
    <p class="function-signature">class ComponentProfiler(config: Dict[str, Any])</p>
    <p>Component vulnerability profiling module.</p>
    <p>Key methods:</p>
    
    <div class="function-signature">analyze(grid_components: pd.DataFrame, outage_records: pd.DataFrame, save_path: Optional[str] = None) -> pd.DataFrame</div>
    <p>Analyzes component vulnerability based on historical data.</p>
    <p class="parameter"><strong>grid_components</strong>: DataFrame with grid component information</p>
    <p class="parameter"><strong>outage_records</strong>: DataFrame with outage records</p>
    <p class="parameter"><strong>save_path</strong>: Path to save results</p>
    <p class="returns">Returns: Component vulnerability scores as DataFrame</p>
    
    <h3>5.3. EnvironmentalThreatModeler</h3>
    <p class="function-signature">class EnvironmentalThreatModeler(config: Dict[str, Any])</p>
    <p>Environmental threat modeling module.</p>
    <p>Key methods:</p>
    
    <div class="function-signature">analyze(weather_history: pd.DataFrame, outage_records: pd.DataFrame, save_path: Optional[str] = None) -> Dict[str, Any]</div>
    <p>Analyzes environmental threats based on weather and outage data.</p>
    <p class="parameter"><strong>weather_history</strong>: DataFrame with weather data</p>
    <p class="parameter"><strong>outage_records</strong>: DataFrame with outage records</p>
    <p class="parameter"><strong>save_path</strong>: Path to save results</p>
    <p class="returns">Returns: Dictionary with environmental threat profiles</p>
    
    <h3>5.4. CorrelationAnalyzer</h3>
    <p class="function-signature">class CorrelationAnalyzer(config: Dict[str, Any])</p>
    <p>Correlation analysis module.</p>
    <p>Key methods:</p>
    
    <div class="function-signature">analyze(vulnerability_scores: pd.DataFrame, environmental_threats: Dict[str, pd.DataFrame], weather_history: pd.DataFrame, outage_records: pd.DataFrame, save_path: Optional[str] = None) -> Dict[str, Any]</div>
    <p>Analyzes correlations between environmental conditions and vulnerabilities.</p>
    <p class="parameter"><strong>vulnerability_scores</strong>: DataFrame with component vulnerability scores</p>
    <p class="parameter"><strong>environmental_threats</strong>: Dictionary with environmental threat profiles</p>
    <p class="parameter"><strong>weather_history</strong>: DataFrame with weather history</p>
    <p class="parameter"><strong>outage_records</strong>: DataFrame with outage records</p>
    <p class="parameter"><strong>save_path</strong>: Path to save results</p>
    <p class="returns">Returns: Dictionary with correlation analysis results</p>

    <h2 id="execution">6. Execution Commands</h2>
    <p>Here are some examples of how to use the Vulnerability Analysis Module in Python code:</p>
    
    <h3>6.1. Basic Usage</h3>
    <pre><code>from gfmf.vulnerability_analysis import VulnerabilityAnalysisModule

# Initialize the module
vulnerability_module = VulnerabilityAnalysisModule()

# Load data from Module 1
data = vulnerability_module.load_input_data()

# Run analysis
results = vulnerability_module.run_analysis()

# Access results
vulnerability_scores = results['component_vulnerability']['vulnerability_scores']
threat_profiles = results['environmental_threats']['threat_profiles']
correlation_matrices = results['correlations']['correlation_matrices']</code></pre>
    
    <h3>6.2. Using Custom Configuration</h3>
    <pre><code>from gfmf.vulnerability_analysis import VulnerabilityAnalysisModule

# Initialize with custom configuration
vulnerability_module = VulnerabilityAnalysisModule(config_path='path/to/custom_config.yaml')

# Run analysis with synthetic data (for testing)
results = vulnerability_module.run_analysis(use_synthetic=True)</code></pre>
    
    <h3>6.3. Using Individual Components</h3>
    <pre><code>from gfmf.vulnerability_analysis import VulnerabilityAnalysisModule
from gfmf.vulnerability_analysis.component_profiler import ComponentProfiler
from gfmf.vulnerability_analysis.environmental_modeler import EnvironmentalThreatModeler
from gfmf.vulnerability_analysis.correlation_analyzer import CorrelationAnalyzer

# Initialize the module
vulnerability_module = VulnerabilityAnalysisModule()

# Load data
data = vulnerability_module.load_input_data()
grid_components = data['grid_components']
weather_history = data['weather_history']
outage_records = data['outage_records']

# Initialize individual components with configuration
config = vulnerability_module.config
profiler = ComponentProfiler(config)
env_modeler = EnvironmentalThreatModeler(config)
corr_analyzer = CorrelationAnalyzer(config)

# Run component profiling
vulnerability_scores = profiler.analyze(
    grid_components, 
    outage_records,
    save_path='results/component_profiling'
)

# Run environmental threat modeling
threat_profiles = env_modeler.analyze(
    weather_history, 
    outage_records,
    save_path='results/environmental_threats'
)

# Run correlation analysis
correlation_results = corr_analyzer.analyze(
    vulnerability_scores,
    threat_profiles,
    weather_history,
    outage_records,
    save_path='results/correlations'
)</code></pre>
    
    <h3>6.4. Command Line Execution</h3>
    <p>To run the vulnerability analysis module from the command line:</p>
    <div class="command">python -m gfmf.vulnerability_analysis --config config/custom_config.yaml --output results/vulnerability_analysis</div>
    
    <h3>6.5. Running with Synthetic Data</h3>
    <div class="command">python -m gfmf.vulnerability_analysis --synthetic --output results/synthetic_test</div>
    
    <h3>6.6. Loading Previous Results</h3>
    <pre><code>from gfmf.vulnerability_analysis import load_vulnerability_analysis_outputs

# Load previous results
results = load_vulnerability_analysis_outputs('results/vulnerability_analysis')

# Access specific results
vulnerability_scores = results['component_vulnerability']['vulnerability_scores']
threat_profiles = results['environmental_threats']['threat_profiles']
correlation_matrices = results['correlations']['correlation_matrices']</code></pre>

    <h2 id="configuration">7. Configuration</h2>
    <p>
        The Vulnerability Analysis Module can be configured using a YAML configuration file. Here's the default
        configuration structure:
    </p>
    <pre><code># Vulnerability Analysis Module Configuration

paths:
  input_data: data/processed/
  output_data: data/vulnerability_analysis/
  logs: logs/vulnerability_analysis/

component_profiling:
  model_type: random_forest  # Options: random_forest, gradient_boosting
  test_size: 0.2
  epochs: 100
  batch_size: 64
  learning_rate: 0.001
  hidden_layers: [64, 32]  # For neural network models
  feature_selection: true
  cross_validation: true
  cv_folds: 5

environmental_threat:
  threat_types: 
    - high_temperature
    - low_temperature
    - high_wind
    - precipitation
  threshold_percentiles:
    high_temperature: 95
    low_temperature: 5
    high_wind: 95
    precipitation: 95
  calculate_cumulative: true
  time_lag_analysis: true
  max_lag_days: 7
  seasonal_adjustment: true
  location_based_thresholds: true

correlation_analysis:
  correlation_methods: 
    - pearson
    - spearman
  control_variables: 
    - season
    - time_of_day
  component_grouping: true
  significance_level: 0.05
  generate_visualizations: true
  feature_clustering: true
  cluster_method: hierarchical
  temporal_analysis:
    enabled: true
    min_window_days: 30
    max_window_days: 365

logging:
  level: INFO
  file: logs/vulnerability_analysis/module.log
  rotation: 5MB  # Rotate log file when it reaches this size
  backups: 3     # Keep this many backup log files
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"

visualization:
  style: seaborn-whitegrid
  figure_size: [12, 8]
  dpi: 300
  interactive: false  # Set to true for interactive visualizations
  color_palette: viridis
  save_formats: 
    - png
    - svg</code></pre>
    
    <h3>7.1. Configuration Sections</h3>
    
    <h4>7.1.1. Paths</h4>
    <ul>
        <li><strong>input_data</strong>: Path to the processed data from Module 1</li>
        <li><strong>output_data</strong>: Path to save the analysis results</li>
        <li><strong>logs</strong>: Path to save log files</li>
    </ul>
    
    <h4>7.1.2. Component Profiling</h4>
    <ul>
        <li><strong>model_type</strong>: Type of machine learning model to use ('random_forest', 'gradient_boosting')</li>
        <li><strong>test_size</strong>: Fraction of data to use for testing</li>
        <li><strong>epochs</strong>: Number of training epochs for neural network models</li>
        <li><strong>batch_size</strong>: Batch size for training</li>
        <li><strong>learning_rate</strong>: Learning rate for the optimizer</li>
        <li><strong>hidden_layers</strong>: List of hidden layer sizes for neural network models</li>
        <li><strong>feature_selection</strong>: Whether to perform feature selection</li>
        <li><strong>cross_validation</strong>: Whether to use cross-validation</li>
        <li><strong>cv_folds</strong>: Number of cross-validation folds</li>
    </ul>
    
    <h4>7.1.3. Environmental Threat</h4>
    <ul>
        <li><strong>threat_types</strong>: List of environmental threat types to analyze</li>
        <li><strong>threshold_percentiles</strong>: Percentile thresholds for different threat types</li>
        <li><strong>calculate_cumulative</strong>: Whether to calculate cumulative threats</li>
        <li><strong>time_lag_analysis</strong>: Whether to perform time-lagged analysis</li>
        <li><strong>max_lag_days</strong>: Maximum number of days for time lag analysis</li>
        <li><strong>seasonal_adjustment</strong>: Whether to apply seasonal adjustments</li>
        <li><strong>location_based_thresholds</strong>: Whether to use location-specific thresholds</li>
    </ul>
    
    <h4>7.1.4. Correlation Analysis</h4>
    <ul>
        <li><strong>correlation_methods</strong>: List of correlation methods to use</li>
        <li><strong>control_variables</strong>: List of control variables for partial correlation</li>
        <li><strong>component_grouping</strong>: Whether to group components for analysis</li>
        <li><strong>significance_level</strong>: Statistical significance level</li>
        <li><strong>generate_visualizations</strong>: Whether to generate visualizations</li>
        <li><strong>feature_clustering</strong>: Whether to cluster features</li>
        <li><strong>cluster_method</strong>: Method to use for clustering</li>
        <li><strong>temporal_analysis</strong>: Settings for temporal correlation analysis</li>
    </ul>
    
    <h4>7.1.5. Logging</h4>
    <ul>
        <li><strong>level</strong>: Logging level (INFO, DEBUG, WARNING, ERROR)</li>
        <li><strong>file</strong>: Path to the log file</li>
        <li><strong>rotation</strong>: Size at which to rotate the log file</li>
        <li><strong>backups</strong>: Number of backup log files to keep</li>
        <li><strong>format</strong>: Format string for log messages</li>
    </ul>
    
    <h4>7.1.6. Visualization</h4>
    <ul>
        <li><strong>style</strong>: Matplotlib/Seaborn style for visualizations</li>
        <li><strong>figure_size</strong>: Default figure size</li>
        <li><strong>dpi</strong>: Resolution for saved figures</li>
        <li><strong>interactive</strong>: Whether to create interactive visualizations</li>
        <li><strong>color_palette</strong>: Color palette for visualizations</li>
        <li><strong>save_formats</strong>: List of formats to save visualizations in</li>
    </ul>

    <h2 id="detailed-components">8. Detailed Component Documentation</h2>
    
    <h3 id="component-profiler">8.1. Component Profiler</h3>
    <p>
        The <code>ComponentProfiler</code> is responsible for analyzing individual grid components
        and assigning vulnerability scores based on historical outage data and component characteristics.
    </p>
    
    <h4>8.1.1. Workflow</h4>
    <div class="diagram-container">
        <div class="mermaid">
%%{init: {'theme': 'default', 'themeVariables': { 'fontSize': '16px'}}}%%
flowchart LR
    A["Grid Components"] --> B["Preprocess Data"]
    C["Outage Records"] --> B
    B --> D["Create Feature Matrix"]
    D --> E["Train ML Model"]
    E --> F["Calculate Vulnerability Scores"]
    F --> G["Generate Visualizations"]
    F --> H["Save Results"]
        </div>
    </div>
    
    <h4>8.1.2. Key Steps in Component Profiling</h4>
    <ol>
        <li><strong>Data Preprocessing</strong>: Clean and prepare grid component and outage data</li>
        <li><strong>Feature Matrix Creation</strong>: Extract and calculate features for modeling</li>
        <li><strong>Model Training</strong>: Train a machine learning model to predict component failures</li>
        <li><strong>Vulnerability Scoring</strong>: Calculate vulnerability scores for each component</li>
        <li><strong>Visualization</strong>: Generate visualizations of vulnerability scores</li>
    </ol>
    
    <h4>8.1.3. Feature Extraction</h4>
    <p>
        The component profiler extracts various features from the grid components and outage records:
    </p>
    <ul>
        <li><strong>Component Properties</strong>: Type, age, capacity, location, etc.</li>
        <li><strong>Topological Features</strong>: Centrality, degree, connectivity</li>
        <li><strong>Historical Outage Statistics</strong>: Number of outages, average outage duration</li>
        <li><strong>Time-based Features</strong>: Seasonal patterns, time of day patterns</li>
    </ul>
    
    <h4>8.1.4. Vulnerability Models</h4>
    <p>
        The component profiler supports multiple machine learning models for vulnerability assessment:
    </p>
    <ul>
        <li><strong>Random Forest</strong>: Ensemble of decision trees (default model)</li>
        <li><strong>Gradient Boosting</strong>: Sequential ensemble of decision trees</li>
    </ul>
    
    <h4>8.1.5. Example: Component Vulnerability Analysis</h4>
    <pre><code>from gfmf.vulnerability_analysis.component_profiler import ComponentProfiler
import pandas as pd

# Example configuration
config = {
    'component_profiling': {
        'model_type': 'random_forest',
        'test_size': 0.2,
        'feature_selection': True
    }
}

# Initialize component profiler
profiler = ComponentProfiler(config)

# Load example data
grid_components = pd.read_csv('data/processed/grid_components.csv')
outage_records = pd.read_csv('data/processed/outage_records.csv')

# Convert timestamp columns to datetime
outage_records['start_time'] = pd.to_datetime(outage_records['start_time'])
outage_records['end_time'] = pd.to_datetime(outage_records['end_time'])

# Run analysis
vulnerability_scores = profiler.analyze(
    grid_components,
    outage_records,
    save_path='results/component_profiling'
)

# Display top vulnerable components
top_vulnerable = vulnerability_scores.sort_values('vulnerability_score', ascending=False).head(10)
print("Top 10 Most Vulnerable Components:")
print(top_vulnerable[['component_id', 'component_type', 'vulnerability_score']])</code></pre>
    
    <h3 id="environmental-modeler">8.2. Environmental Threat Modeler</h3>
    <p>
        The <code>EnvironmentalThreatModeler</code> analyzes weather data to identify environmental
        conditions that increase the risk of grid component failures.
    </p>
    
    <h4>8.2.1. Workflow</h4>
    <div class="diagram-container">
        <div class="mermaid">
%%{init: {'theme': 'default', 'themeVariables': { 'fontSize': '16px'}}}%%
flowchart LR
    A["Weather History"] --> B["Identify Threat Thresholds"]
    C["Outage Records"] --> B
    B --> D["Calculate Threat Levels"]
    D --> E["Analyze Time Lags"]
    E --> F["Create Threat Profiles"]
    F --> G["Generate Visualizations"]
    F --> H["Save Results"]
        </div>
    </div>
    
    <h4>8.2.2. Key Steps in Environmental Threat Modeling</h4>
    <ol>
        <li><strong>Threat Threshold Identification</strong>: Determine optimal thresholds for weather variables</li>
        <li><strong>Threat Level Calculation</strong>: Calculate the threat level for each weather variable</li>
        <li><strong>Time-Lagged Analysis</strong>: Analyze delayed effects of weather conditions on failures</li>
        <li><strong>Threat Profile Creation</strong>: Create threat profiles for different types of environmental conditions</li>
        <li><strong>Visualization</strong>: Generate visualizations of environmental threats</li>
    </ol>
    
    <h4>8.2.3. Environmental Threat Types</h4>
    <p>
        The environmental threat modeler analyzes several types of threats:
    </p>
    <ul>
        <li><strong>High Temperature</strong>: Extreme heat conditions that stress grid components</li>
        <li><strong>Low Temperature</strong>: Extreme cold conditions that affect component functionality</li>
        <li><strong>High Wind</strong>: Strong winds that can damage overhead lines and equipment</li>
        <li><strong>Precipitation</strong>: Heavy rain, snow, or ice that can impact grid operations</li>
    </ul>
    
    <h4>8.2.4. Example: Environmental Threat Analysis</h4>
    <pre><code>from gfmf.vulnerability_analysis.environmental_modeler import EnvironmentalThreatModeler
import pandas as pd
import matplotlib.pyplot as plt

# Example configuration
config = {
    'environmental_threat': {
        'threat_types': ['high_temperature', 'low_temperature', 'high_wind', 'precipitation'],
        'threshold_percentiles': {
            'high_temperature': 95,
            'low_temperature': 5,
            'high_wind': 95,
            'precipitation': 95
        },
        'time_lag_analysis': True,
        'max_lag_days': 7
    }
}

# Initialize environmental threat modeler
modeler = EnvironmentalThreatModeler(config)

# Load example data
weather_history = pd.read_csv('data/processed/weather_history.csv')
outage_records = pd.read_csv('data/processed/outage_records.csv')

# Convert timestamp columns to datetime
weather_history['timestamp'] = pd.to_datetime(weather_history['timestamp'])
outage_records['start_time'] = pd.to_datetime(outage_records['start_time'])

# Run analysis
threat_profiles = modeler.analyze(
    weather_history,
    outage_records,
    save_path='results/environmental_threats'
)

# Access specific threat profiles
high_temp_profile = threat_profiles['high_temperature']
print(f"High temperature threat profile has {len(high_temp_profile)} records")

# Plot high temperature threat levels over time
plt.figure(figsize=(12, 6))
plt.plot(high_temp_profile.index, high_temp_profile['threat_level'])
plt.title('High Temperature Threat Level Over Time')
plt.xlabel('Date')
plt.ylabel('Threat Level')
plt.grid(True)
plt.show()</code></pre>
    
    <h3 id="correlation-analyzer">8.3. Correlation Analyzer</h3>
    <p>
        The <code>CorrelationAnalyzer</code> examines relationships between component characteristics,
        environmental conditions, and outage events.
    </p>
    
    <h4>8.3.1. Workflow</h4>
    <div class="diagram-container">
        <div class="mermaid">
%%{init: {'theme': 'default', 'themeVariables': { 'fontSize': '16px'}}}%%
flowchart LR
    A["Combined Dataset Creation"] --> B["Calculate Correlation Matrices"]
    B --> C["Calculate Partial Correlations"]
    C --> D["Group Component Analysis"]
    D --> E["Generate Visualizations"]
    E --> F["Save Results"]
        </div>
    </div>
    
    <h4>8.3.2. Key Steps in Correlation Analysis</h4>
    <ol>
        <li><strong>Combined Dataset Creation</strong>: Merge component, weather, and outage data</li>
        <li><strong>Correlation Matrix Calculation</strong>: Calculate correlations between all pairs of variables</li>
        <li><strong>Partial Correlation Analysis</strong>: Calculate correlations controlling for confounding variables</li>
        <li><strong>Component Group Analysis</strong>: Analyze correlations within component groups</li>
        <li><strong>Visualization</strong>: Generate correlation heatmaps and other visualizations</li>
    </ol>
    
    <h4>8.3.3. Correlation Methods</h4>
    <p>
        The correlation analyzer supports multiple correlation methods:
    </p>
    <ul>
        <li><strong>Pearson Correlation</strong>: Measures linear relationships between variables</li>
        <li><strong>Spearman Correlation</strong>: Measures monotonic relationships between variables</li>
    </ul>
    
    <h4>8.3.4. Example: Correlation Analysis</h4>
    <pre><code>from gfmf.vulnerability_analysis.correlation_analyzer import CorrelationAnalyzer
import pandas as pd
import seaborn as sns
import matplotlib.pyplot as plt

# Example configuration
config = {
    'correlation_analysis': {
        'correlation_methods': ['pearson', 'spearman'],
        'control_variables': ['season', 'time_of_day'],
        'component_grouping': True,
        'significance_level': 0.05
    }
}

# Initialize correlation analyzer
analyzer = CorrelationAnalyzer(config)

# Load example data
vulnerability_scores = pd.read_csv('results/component_profiling/vulnerability_scores.csv')
weather_history = pd.read_csv('data/processed/weather_history.csv')
outage_records = pd.read_csv('data/processed/outage_records.csv')

# Load environmental threat profiles
import pickle
with open('results/environmental_threats/threat_profiles.pkl', 'rb') as f:
    environmental_threats = pickle.load(f)

# Convert timestamp columns to datetime
weather_history['timestamp'] = pd.to_datetime(weather_history['timestamp'])
outage_records['start_time'] = pd.to_datetime(outage_records['start_time'])

# Run analysis
correlation_results = analyzer.analyze(
    vulnerability_scores,
    environmental_threats,
    weather_history,
    outage_records,
    save_path='results/correlations'
)

# Access pearson correlation matrix
pearson_matrix = correlation_results['correlation_matrices']['pearson']

# Plot correlation heatmap
plt.figure(figsize=(14, 12))
sns.heatmap(
    pearson_matrix,
    annot=True,
    cmap='coolwarm',
    vmin=-1,
    vmax=1,
    center=0,
    fmt='.2f'
)
plt.title('Pearson Correlation Matrix')
plt.tight_layout()
plt.show()

# Display top 5 strongest correlations
corr_values = pearson_matrix.unstack().sort_values(ascending=False)
print("Top 5 Strongest Correlations:")
print(corr_values[corr_values < 1].head(5))</code></pre>
    
    <h3 id="statistical-tools">8.4. Statistical Tools</h3>
    <p>
        The <code>statistical_tools.py</code> module provides utilities for statistical analysis:
    </p>
    
    <h4>8.4.1. Correlation Functions</h4>
    <ul>
        <li><strong>calculate_correlation</strong>: Calculate correlation between two data series with p-value</li>
        <li><strong>calculate_partial_correlation</strong>: Calculate correlation controlling for confounding variables</li>
        <li><strong>calculate_time_lagged_correlation</strong>: Calculate correlations with time lags</li>
    </ul>
    
    <h4>8.4.2. Threshold Analysis</h4>
    <ul>
        <li><strong>find_optimal_threshold</strong>: Find optimal threshold value that maximizes correlation with target</li>
    </ul>
    
    <h4>8.4.3. Statistical Analysis</h4>
    <ul>
        <li><strong>detect_outliers</strong>: Identify outliers in data</li>
        <li><strong>bootstrap_confidence_interval</strong>: Calculate confidence intervals using bootstrapping</li>
        <li><strong>grouped_statistical_test</strong>: Perform statistical tests on grouped data</li>
    </ul>
    
    <h4>8.4.4. Failure Analysis</h4>
    <ul>
        <li><strong>estimate_failure_probability</strong>: Estimate failure probability based on historical outages</li>
    </ul>
    
    <h3 id="visualization">8.5. Visualization Utilities</h3>
    <p>
        The <code>visualization.py</code> module provides functions for creating visualizations:
    </p>
    
    <h4>8.5.1. Component Vulnerability Visualizations</h4>
    <ul>
        <li><strong>plot_component_vulnerability_scores</strong>: Plot component vulnerability scores</li>
        <li><strong>plot_vulnerability_distribution</strong>: Plot distribution of vulnerability scores</li>
        <li><strong>plot_feature_importance</strong>: Plot feature importance for vulnerability models</li>
    </ul>
    
    <h4>8.5.2. Environmental Threat Visualizations</h4>
    <ul>
        <li><strong>plot_environmental_threat_heatmap</strong>: Plot heatmap of environmental threats</li>
        <li><strong>plot_time_series_with_events</strong>: Plot time series data with event markers</li>
    </ul>
    
    <h4>8.5.3. Correlation Visualizations</h4>
    <ul>
        <li><strong>plot_correlation_matrix</strong>: Plot correlation matrix as heatmap</li>
    </ul>
    
    <h4>8.5.4. Spatial Visualizations</h4>
    <ul>
        <li><strong>plot_vulnerability_map</strong>: Plot spatial map of component vulnerabilities</li>
    </ul>
    
    <h3 id="validators">8.6. Data Validators</h3>
    <p>
        The <code>validators.py</code> module provides functions for validating input data:
    </p>
    
    <h4>8.6.1. Data Validation Functions</h4>
    <ul>
        <li><strong>validate_grid_components</strong>: Validate grid component data structure and values</li>
        <li><strong>validate_weather_history</strong>: Validate weather history data structure and values</li>
        <li><strong>validate_outage_records</strong>: Validate outage records data structure and values</li>
        <li><strong>validate_combined_dataset</strong>: Validate combined dataset structure and values</li>
    </ul>
    
    <h4>8.6.2. Completeness Check</h4>
    <ul>
        <li><strong>check_data_completeness</strong>: Check for missing data points in time series</li>
    </ul>
    
    <h4>8.6.3. Compatibility Check</h4>
    <ul>
        <li><strong>validate_input_data_compatibility</strong>: Check if different datasets are compatible</li>
    </ul>
    
    <div class="note">
        <strong>Note:</strong> This documentation provides an overview of the Vulnerability Analysis Module.
        For more detailed information on specific components, refer to the inline documentation in the
        source code files.
    </div>

    <script>
        // Initialize Mermaid diagrams
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(function() {
                // Use timeout to ensure diagrams have chance to render
                try {
                    mermaid.init(undefined, document.querySelectorAll('.mermaid'));
                    console.log("Mermaid diagrams initialized");
                } catch (e) {
                    console.error("Error initializing Mermaid diagrams:", e);
                }
            }, 500);
        });
    </script>
</body>
</html> 